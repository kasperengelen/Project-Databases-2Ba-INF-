{% extends 'layout.html' %}

{% block body %}
	<div class="jumbotron" style="padding: 1%;">
		<div class="row">
			<div class="col-sm-3 text-left">
				<a href="{{ url_for('dataset_pages.list_dataset') }}" class="btn btn-primary">Datasets</a>
			</div>
			<div class="col-sm-6 text-center">
				<h2>{{ dataset_info.name }}</h2>
				<p>{{ dataset_info.desc }}</p>
			</div>
			{% if perm_type == 'admin' %}
				<div class="col-sm-3 text-right">
					<div>
						<a href="{{ url_for('dataset_pages.manage_dataset', dataset_id=dataset_info.setid) }}" 
							class="btn btn-primary">Manage</a>
						</br>
						</br>
						<a href="{{ url_for('dataset_pages.edit_perms_dataset', dataset_id=dataset_info.setid) }}" 
							class="btn btn-primary">Permissions</a>
					</div>
				</div>
			{% endif %}
		</div>
	</div>

	{% if (perm_type == 'admin' or perm_type == 'write') %}
		<div class="panel-group" id="accordion">
		    <div class="panel panel-default">
		      	<div class="panel-heading">
		        	<h4 class="panel-title">
		          		<a data-toggle="collapse" data-Hang onparent="#accordion" href="#add">Add Table</a>
		        	</h4>
		      	</div>
		      	<div id="add" class="panel-collapse collapse">
		        	<div class="panel-body">
		        		{% from "includes/_formhelpers.html" import render_field %}
						<form method="post" enctype="multipart/form-data" action="{{ url_for('dataset_pages.upload', 
						dataset_id=dataset_info.setid) }}">
							{{ form.hidden_tag() }}
							<div class="form-group" style="width: 50%;">
	                 			{{render_field(form.data_file, class_="form-control")}}  
	                		</div>
	                		<p style="display: inline-block;">Column names included? (Only CSV)     </p>
	                		<div class="form-group" style="display: inline-block;">
	                			{{ form.columnnames_included }}
	                		</div>
							<p><input type="submit" class="btn btn-primary" value="Upload File"></p>
						</form>
						<p>Allowed extensions: .csv, .zip, .dump, .sql</p>
		        	</div>
		      	</div>
		    </div>
		    <div class="panel panel-default">
		      	<div class="panel-heading">
		        	<h4 class="panel-title">
		         		<a data-toggle="collapse" data-parent="#accordion" href="#join">Join Tables</a>
		        	</h4>
		      	</div>
		      	<div id="join" class="panel-collapse collapse">
		        	<div class="panel-body">	
		        		Join Form
		        	</div>
	     		</div>
	    	</div>
	  	</div>		
	{% endif %}

    <div class="jumbotron">
    	<div style="overflow-x: auto;">
			<table>
				{% if table_list %}
					<tr>
						<th>Tables</th>
						<th></th>
					</tr>

					{% for table in table_list %}
					<tr>
						<td><a href="{{ url_for('dataset_pages.view_dataset_table', dataset_id=dataset_info.setid, tablename=table) }}">
							{{ table }}</a></td>
						<td><a id="file" href="#" data-toggle="modal" data-target="#downloadFormModal_{{ table }}">Export to CSV</a></td>
						<!-- Download dialog. -->
						<div id="downloadFormModal_{{ table }}" class="modal fade" role="dialog">
					        <div class="modal-dialog">
					        
					            <!-- Modal content-->
					            <div class="modal-content">
					                <div class="modal-header">
					                    <button type="button" class="close" data-dismiss="modal">&times;</button>
					                    <h4 class="modal-title">Download table.</h4>
					                </div>
					                <div class="modal-body">
					                	<!-- Download form -->
					                	{% from "includes/_formhelpers.html" import render_field %}
					                    <form action="{{ url_for('dataset_pages.download', dataset_id=dataset_info.setid, tablename=table)}}" method="get" 
					                    	id="downloadForm_{{ table }}">
                                            {{ downloadform.hidden_tag() }}
					                    	<div class="form-group">
					                    		{{ render_field(downloadform.delimiter, class_="form-control") }}
					                    	</div>
					                    	<div class="form-group">
					                    		{{ render_field(downloadform.quotechar, class_="form-control") }}
					                    	</div>
					                    	<div class="form-group">
					                    		{{ render_field(downloadform.nullrep, class_="form-control") }}
					                    	</div>
                                    		<input id="downloadForm_{{ table }}" class="btn btn-primary" type="submit" value="Download">
					                    </form>
					                    <!-- Download form -->
					                </div>
					                <div class="modal-footer">
					                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					                </div>
					            </div>
					            <!-- Modal content -->
					        </div>
						</div>
						<!-- Download dialog. -->
					</tr>
					{% endfor %}
					
				{% endif %}
			</table>
		</div>
	</div>
{% endblock %}
